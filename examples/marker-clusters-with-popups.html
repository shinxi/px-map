<!--
Copyright (c) 2018, General Electric

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Map Demo -- Marker Clusters</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../polymer/polymer.html"/>

  <!-- Importing px-map subcomponents... -->
  <link rel="import" href="../px-map.html"/>
  <link rel="import" href="../px-map-tile-layer.html"/>
  <link rel="import" href="../px-map-control-zoom.html"/>
  <link rel="import" href="../px-map-marker-group.html"/>

  <style>
    body {
      margin: 0;
    }
    .wrap {
      display: flex;
      height: 100vh;
    }
    .nav-link {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: white;
      z-index: 999;
    }
    .nav-link ul {
      padding: 0;
      margin: 20px;
    }
    .nav-link ul li {
      list-style-type: none;
      padding: 5px 0;
    }
  </style>
</head>
<body>
  <section class="wrap">
    <dom-bind>
      <template is="dom-bind">
        <px-map id="pxMap" flex-to-size on-px-map-moved="mapMove">
          <px-map-tile-layer url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"></px-map-tile-layer>
          <px-map-control-zoom position="bottomright"></px-map-control-zoom>

          <!-- Data-bind the output of the iron-ajax call `geoJSON` to the marker group's `data` attribute -->
          <px-map-marker-group id="pxMarkerGroup" name="Places" data="{{geoJSON}}"></px-map-marker-group>
        </px-map>
      </template>
    </dom-bind>
  </section>
  <section class="nav-link">
    <ul>
      <li><button id="markerOne">Marker One</button></li>
      <li><button id="markerTwo">Marker Two</button></li>
      <li><button id="markerThree">Marker Three</button></li>
      <li><button id="updateData">Update Data</button></li>
      <li><button id="markerFour">Marker Four</button></li>
      <li><button id="markerFive">Marker Five</button></li>
    </ul>
    <ul>
      <li><button id="markerCloseAllPopups">Marker - Close All Popups</button></li>
    </ul>
  </section>
  <script>
    var tmplQuery = Polymer.Element ? 'dom-bind' : 'template[is=dom-bind]';
    var tmpl = document.querySelector(tmplQuery);

    document.addEventListener('WebComponentsReady', function() {
      var featCollection = {
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.24042573",
                "32.67445793"
              ]
            },
            "properties": {
              "title": "Cabrillo National Monument",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Cabrillo National Monument",
                "popup-data": {
                  "LAT": "32.67445793",
                  "LNG": "-117.24042573",
                  "STATE": "warning"
                }
              }
            },
            "id": "10001"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.26867322",
                "32.8458467"
              ]
            },
            "properties": {
              "title": "Pearl St & Draper Av",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "info",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Pearl St & Draper Av",
                "popup-data": {
                  "LAT": "32.8458467",
                  "LNG": "-117.26867322",
                  "STATE": "info"
                }
              }
            },
            "id": "10003"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.26867322",
                "32.8458467"
              ]
            },
            "properties": {
              "title": "Pearl St & Fay Av",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Pearl St & Fay Av",
                "popup-data": {
                  "LAT": "32.8458467",
                  "LNG": "-117.26867322",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10004"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.26867322",
                "32.8458467"
              ]
            },
            "properties": {
              "title": "Torrey Pines Rd & Exchange Pl",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "important",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Torrey Pines Rd & Exchange Pl",
                "popup-data": {
                  "LAT": "32.8458467",
                  "LNG": "-117.26867322",
                  "STATE": "important"
                }
              }
            },
            "id": "10006"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.26867322",
                "32.8458467"
              ]
            },
            "properties": {
              "title": "Torrey Pines Rd & Hillside Dr",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Torrey Pines Rd & Hillside Dr",
                "popup-data": {
                  "LAT": "32.8458467",
                  "LNG": "-117.26867322",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10007"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.26867322",
                "32.8458467"
              ]
            },
            "properties": {
              "title": "Torrey Pines Rd & Hillside Dr",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Torrey Pines Rd & Hillside Dr",
                "popup-data": {
                  "LAT": "32.8458467",
                  "LNG": "-117.26867322",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10011"
            },
            {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.24583394",
                "32.79652904"
              ]
            },
            "properties": {
              "title": "Grand Av & Fanuel St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Grand Av & Fanuel St",
                "popup-data": {
                  "LAT": "32.79652904",
                  "LNG": "-117.24583394",
                  "STATE": "warning"
                }
              }
            },
            "id": "10012"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.24277358",
                "32.79929398"
              ]
            },
            "properties": {
              "title": "Garnet Av & Haines St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "info",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Haines St",
                "popup-data": {
                  "LAT": "32.79929398",
                  "LNG": "-117.24277358",
                  "STATE": "info"
                }
              }
            },
            "id": "10013"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.24120249",
                "32.79965017"
              ]
            },
            "properties": {
              "title": "Garnet Av & Ingraham St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "important",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Ingraham St",
                "popup-data": {
                  "LAT": "32.79965017",
                  "LNG": "-117.24120249",
                  "STATE": "important"
                }
              }
            },
            "id": "10015"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.23906319",
                "32.80012359"
              ]
            },
            "properties": {
              "title": "Garnet Av & Jewell St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Jewell St",
                "popup-data": {
                  "LAT": "32.80012359",
                  "LNG": "-117.23906319",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10016"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.23574899",
                "32.74506671"
              ]
            },
            "properties": {
              "title": "Voltaire St & Mendocino St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Voltaire St & Mendocino St",
                "popup-data": {
                  "LAT": "32.74506671",
                  "LNG": "-117.23574899",
                  "STATE": "warning"
                }
              }
            },
            "id": "10020"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.23556667",
                "32.80087716"
              ]
            },
            "properties": {
              "title": "Garnet Av & Lamont St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Lamont St",
                "popup-data": {
                  "LAT": "32.80087716",
                  "LNG": "-117.23556667",
                  "STATE": "warning"
                }
              }
            },
            "id": "10023"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.23353563",
                "32.74286905"
              ]
            },
            "properties": {
              "title": "Voltaire St & San Clemente St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Voltaire St & San Clemente St",
                "popup-data": {
                  "LAT": "32.74286905",
                  "LNG": "-117.23353563",
                  "STATE": "warning"
                }
              }
            },
            "id": "10024"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.23174882",
                "32.8017129"
              ]
            },
            "properties": {
              "title": "Garnet Av & Noyes St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Noyes St",
                "popup-data": {
                  "LAT": "32.8017129",
                  "LNG": "-117.23174882",
                  "STATE": "warning"
                }
              }
            },
            "id": "10025"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22970402",
                "32.73814733"
              ]
            },
            "properties": {
              "title": "Chatsworth Bl & Tennyson St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Chatsworth Bl & Tennyson St",
                "popup-data": {
                  "LAT": "32.73814733",
                  "LNG": "-117.22970402",
                  "STATE": "warning"
                }
              }
            },
            "id": "10026"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22929493",
                "32.74025595"
              ]
            },
            "properties": {
              "title": "Voltaire St & Poinsettia Dr",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Voltaire St & Poinsettia Dr",
                "popup-data": {
                  "LAT": "32.74025595",
                  "LNG": "-117.22929493",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10027"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22673314",
                "32.75266115"
              ]
            },
            "properties": {
              "title": "West Point Loma Bl & Adrian St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "West Point Loma Bl & Adrian St",
                "popup-data": {
                  "LAT": "32.75266115",
                  "LNG": "-117.22673314",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10029"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.2265353",
                "32.72894288"
              ]
            },
            "properties": {
              "title": "Nimitz Bl & Rosecrans St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Nimitz Bl & Rosecrans St",
                "popup-data": {
                  "LAT": "32.72894288",
                  "LNG": "-117.2265353",
                  "STATE": "warning"
                }
              }
            },
            "id": "10031"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22584945",
                "32.80091313"
              ]
            },
            "properties": {
              "title": "Grand Av & Culver St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "info",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Grand Av & Culver St",
                "popup-data": {
                  "LAT": "32.80091313",
                  "LNG": "-117.22584945",
                  "STATE": "info"
                }
              }
            },
            "id": "10032"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22407745",
                "32.75340225"
              ]
            },
            "properties": {
              "title": "West Point Loma Bl & Loma Riviera Dr",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "West Point Loma Bl & Loma Riviera Dr",
                "popup-data": {
                  "LAT": "32.75340225",
                  "LNG": "-117.22407745",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10033"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22518324",
                "32.86829317"
              ]
            },
            "properties": {
              "title": "Nobel Dr & Lebon Dr",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "unknown",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Nobel Dr & Lebon Dr",
                "popup-data": {
                  "LAT": "32.86829317",
                  "LNG": "-117.22518324",
                  "STATE": "unknown"
                }
              }
            },
            "id": "10034"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                "-117.22121375",
                "32.805504"
              ]
            },
            "properties": {
              "title": "Garnet Av & Bond St",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning",

              },
              "marker-popup": {
                "popup-base": "data-popup",
                "popup-title": "Garnet Av & Bond St",
                "popup-data": {
                  "LAT": "32.805504",
                  "LNG": "-117.22121375",
                  "STATE": "warning"
                }
              }
            },
            "id": "10036"
          }
        ]
      };
      var featCollection1 = {
        "type": "FeatureCollection",
        "features": [
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                -121.9588851928711,
                37.77926289427511
              ]
            },
            "properties": {
            "title": "Cabrillo National Monument",
            "marker-icon": {
              "icon-base": "static-icon",
              "icon-type": "warning"
            },
            "marker-popup": {
              "popup-base": "data-popup",
              "popup-title": "Cabrillo National Monument",
              "popup-data": {
                "LAT": "37.77926289427511",
                "LNG": "-121.9588851928711",
                "STATE": "warning"
              }
            }
          },
          "id": "101"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                -121.9588851928711,
                37.77926289427511
              ]
            },
            "properties": {
              "title": "Nobel Dr & Lebon Dr",
              "marker-icon": { "icon-base": "static-icon", "icon-type": "unknown" }
            },
            "id": "102"
          },
          {
            "type": "Feature",
            "geometry": {
              "type": "Point",
              "coordinates": [
                -121.8929672241211,
                37.734340111555134
              ]
            },
            "properties": {
              "title": "Cabrillo National Monument",
              "marker-icon": {
                "icon-base": "static-icon",
                "icon-type": "warning"
              },
              "marker-popup" : {
                "popup-base": "info-popup",
                "popup-title": "Cabrillo National Monument",
                "popup-description" : "Lorem ipsum dot sit amet, colloquas..."
              }
            },
            "id": "103"
          }
        ]
      };
      tmpl.mapMove = function(evt) {
        var markers = Polymer.dom(evt).rootTarget.getVisibleMarkers();
        console.log('There are ' + markers.length + ' markers visible on the map.');
      }
      tmpl.geoJSON = featCollection;

      // pass-in lat/lng and zoom prop to px-map to navigate item clicked
      // pass-in opened prop/featureId to px-marker-group to compare and select feature clicked
      // track if popup opened
      var pxMap = document.getElementById('pxMap');
      var pxMarkerGroup = document.getElementById('pxMarkerGroup');
      const markerOne = document.getElementById('markerOne');
      markerOne.addEventListener('click', function() {
        const [LNG, LAT] = featCollection.features[0].geometry.coordinates;
        const { id } = featCollection.features[0];
        if(!LAT || !LNG) return;
        pxMap.lat = LAT;
        pxMap.lng = LNG;
        pxMap.zoom = 17; //single marker centered to map

        pxMarkerGroup.opened = id;
        this.classList.toggle("highlight-item");
      });

      // reset opened prop to null so, popups on mapInst are closed
      const markerCloseAllPopups = document.getElementById('markerCloseAllPopups');
      markerCloseAllPopups.addEventListener('click', function() {
        pxMarkerGroup.opened = null;
      });

      // marker in a cluster
      document.getElementById('markerTwo').addEventListener('click', function() {
        const [LNG, LAT] = featCollection.features[1].geometry.coordinates;
        const { id } = featCollection.features[1];
        if(!LAT || !LNG) return;
        pxMap.lat = LAT;
        pxMap.lng = LNG;
        pxMap.zoom = 17; //single marker centered to map

        pxMarkerGroup.opened = id;
      });
      // marker in a cluster
      document.getElementById('markerThree').addEventListener('click', function() {
        const [LNG, LAT] = featCollection.features[5].geometry.coordinates;
        const { id } = featCollection.features[5];
        if(!LAT || !LNG) return;
        pxMap.lat = LAT;
        pxMap.lng = LNG;
        pxMap.zoom = 17; //single marker centered to map

        pxMarkerGroup.opened = id;
      });

      // update data
      document.getElementById('updateData').addEventListener('click', function() {
        pxMarkerGroup.data = featCollection1;
      });

      // marker after data update(clustering)
      document.getElementById('markerFour').addEventListener('click', function() {
        const [LNG, LAT] = featCollection1.features[0].geometry.coordinates;
        const { id } = featCollection1.features[0];
        if(!LAT || !LNG) return;
        pxMap.lat = LAT;
        pxMap.lng = LNG;
        pxMap.zoom = 17; //single marker centered to map

        pxMarkerGroup.opened = id;
      });
      // marker after data update(non-clustering)
      document.getElementById('markerFive').addEventListener('click', function() {
        const [LNG, LAT] = featCollection1.features[2].geometry.coordinates;
        const { id } = featCollection1.features[2];
        if(!LAT || !LNG) return;
        pxMap.lat = LAT;
        pxMap.lng = LNG;
        pxMap.zoom = 17; //single marker centered to map

        pxMarkerGroup.opened = id;
      });

    });
  </script>
</body>
</html>
